#!/bin/bash
set -exu
DONE=false
JOB=${1-'python3 -m hmt_escrow.job -v'}
STORAGE=${1-'python3 -m hmt_escrow.storage -v'}
ETH_BRIDGE=${1-'python3 -m hmt_escrow.eth_bridge -v'}

until test -f /deployed/hmt.address.json; do
  echo "waiting for hmt.address.json .."
  sleep 2
done

export HMTOKEN_ADDR=$(cat /deployed/hmt.address.json | jq --raw-output '.address')

until curl --silent ipfs:5001; do
  echo "sleeping"
  sleep 1
done

$JOB
$STORAGE
$ETH_BRIDGE
