FROM node:16.13-buster

ARG PUBLIC_URL
ARG HMT_ADDRESS
ARG ESCROW_FACTORY_ADDRESS
ARG REC_ORACLE_ADDRESS
ARG REP_ORACLE_ADDRESS
ARG EXCHANGE_ORACLE_ADDRESS

WORKDIR /usr/src/app

COPY package.json yarn.lock ./

RUN yarn

COPY ./public ./public
COPY ./src ./src

RUN PUBLIC_URL=$PUBLIC_URL \
    REACT_APP_HMT_ADDRESS=$HMT_ADDRESS \
    REACT_APP_ESCROW_FACTORY_ADDRESS=$ESCROW_FACTORY_ADDRESS \
    REACT_APP_REC_ORACLE_ADDRESS=$REC_ORACLE_ADDRESS \
    REACT_APP_REP_ORACLE_ADDRESS=$REP_ORACLE_ADDRESS \
    REACT_APP_EXCHANGE_ORACLE_ADDRESS=$EXCHANGE_ORACLE_ADDRESS \
    yarn build